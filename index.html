<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ›å»ºä½œå“é›† - ç®¡ç†åå°</title>
    <style>
        /* --- å…¨å±€æ ·å¼ --- */
        * { box-sizing: border-box; outline: none; }
        body, html { margin: 0; padding: 0; height: 100%; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background-color: #F0F2F5; overflow: hidden; }

        /* --- å¸ƒå±€å®¹å™¨ --- */
        .app-container { display: flex; height: 100vh; width: 100vw; transition: all 0.3s; }

        /* --- å·¦ä¾§ä¾§è¾¹æ  --- */
        .sidebar { width: 320px; background: #FFF; border-right: 1px solid #E6E8EB; display: flex; flex-direction: column; padding: 24px 20px; flex-shrink: 0; z-index: 100; transition: transform 0.3s; }
        .sidebar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
        .sidebar-header h2 { font-size: 18px; font-weight: 600; margin: 0; }
        .status-text { font-size: 12px; color: #999; }
        
        /* Tab åˆ‡æ¢ */
        .tab-group { background-color: #F5F7FA; border-radius: 8px; padding: 4px; display: flex; margin-bottom: 24px; }
        .tab-btn { flex: 1; text-align: center; padding: 8px 0; font-size: 14px; color: #666; cursor: pointer; border-radius: 6px; }
        .tab-btn.active { background-color: #FFF; color: #333; font-weight: 500; box-shadow: 0 2px 4px rgba(0,0,0,0.04); }

        /* é¢æ¿æ˜¾ç¤ºæ§åˆ¶ */
        .panel { display: none; height: 100%; overflow-y: auto; }
        .panel.active { display: block; }

        /* --- ä¸Šä¼ åŒºåŸŸ (æ”¯æŒæ‹–æ‹½) --- */
        .upload-area {
            width: 100%; height: 100px; background-color: #3A64FF; border-radius: 8px;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            color: white; cursor: pointer; transition: all 0.2s; position: relative;
            border: 2px solid transparent;
        }
        .upload-area:hover { background-color: #2b50d8; }
        .upload-area.drag-over { background-color: #2b50d8; border-color: #85a1ff; transform: scale(0.99); }
        .upload-icon { font-size: 20px; margin-bottom: 4px; font-weight: bold; }
        .upload-desc { font-size: 10px; opacity: 0.8; }
        #fileInput { display: none; } /* éšè—åŸç”Ÿä¸Šä¼ æ§ä»¶ */

        /* ä¾§è¾¹æ åˆ—è¡¨é¡¹ */
        .layer-list { margin-top: 20px; }
        .layer-item {
            display: flex; align-items: center; background: #F7F8FA; padding: 10px;
            border-radius: 6px; margin-bottom: 8px; font-size: 12px; color: #333;
        }
        .layer-thumb { width: 30px; height: 30px; border-radius: 4px; object-fit: cover; margin-right: 10px; background: #eee; }
        .layer-name { flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

        /* --- è®¾ç½®è¡¨å• --- */
        .form-group { margin-bottom: 24px; }
        .label-row { display: flex; align-items: center; margin-bottom: 8px; font-size: 14px; color: #999; }
        .help-icon { margin-left: 6px; width: 14px; height: 14px; background: #E0E2E5; color: #FFF; border-radius: 50%; font-size: 10px; display: flex; align-items: center; justify-content: center; cursor: help; }
        .input-wrapper { background-color: #F7F8FA; border-radius: 6px; padding: 0 12px; height: 40px; display: flex; align-items: center; }
        .custom-input, .custom-select { width: 100%; background: transparent; border: none; font-size: 14px; height: 100%; }
        .color-preview-box { width: 20px; height: 20px; border-radius: 4px; border: 1px solid rgba(0,0,0,0.1); cursor: pointer; position: relative; overflow: hidden; }
        input[type="color"] { position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; opacity: 0; cursor: pointer; }

        /* --- å³ä¾§ä¸»åŒºåŸŸ --- */
        .main-content { flex: 1; display: flex; flex-direction: column; background-color: #F0F2F5; transition: margin 0.3s; }
        .top-bar { height: 60px; background: #FFF; border-bottom: 1px solid #E6E8EB; display: flex; justify-content: flex-end; align-items: center; padding: 0 24px; flex-shrink: 0; transition: transform 0.3s; z-index: 90; }
        .btn { height: 32px; padding: 0 16px; border-radius: 4px; font-size: 13px; cursor: pointer; margin-left: 12px; font-weight: 500; display: flex; align-items: center; border: 1px solid transparent; }
        .btn-outline { background: #FFF; border-color: #D9D9D9; color: #333; }
        .btn-primary { background: #1A1A1A; color: #FFF; }
        .btn-primary:hover { background: #333; }

        /* --- ç”»å¸ƒåŒºåŸŸ (æ ¸å¿ƒ) --- */
        .canvas-area { flex: 1; padding: 40px; overflow-y: auto; display: flex; justify-content: center; scroll-behavior: smooth; }
        .artwork-preview { width: 100%; max-width: 1440px; min-height: 1000px; background-color: #FFF; box-shadow: 0 4px 12px rgba(0,0,0,0.05); transition: all 0.3s; display: flex; flex-direction: column; }
        
        /* è¿™é‡Œçš„ img å’Œ video æ ·å¼å†³å®šäº† PDF æ•ˆæœ */
        .artwork-preview img, .artwork-preview video {
            width: 100%; display: block; margin-bottom: 0; /* é»˜è®¤æ— é—´è· */
        }

        /* --- é¢„è§ˆæ¨¡å¼ (Preview Mode) --- */
        /* å½“ body åŠ ä¸Š preview-mode ç±»æ—¶ï¼Œéšè—æ‰€æœ‰ UIï¼Œåªç•™ä¸­é—´ */
        body.preview-mode .sidebar { transform: translateX(-320px); width: 0; padding: 0; opacity: 0; }
        body.preview-mode .top-bar { transform: translateY(-60px); }
        body.preview-mode .canvas-area { padding: 0; background: #fff; } /* å»æ‰ç”»å¸ƒå¤–è¾¹è· */
        body.preview-mode .artwork-preview { box-shadow: none; min-height: 100vh; }
        
        /* é€€å‡ºé¢„è§ˆæŒ‰é’® */
        .exit-preview-btn {
            position: fixed; top: 20px; right: 20px; background: rgba(0,0,0,0.5); color: white;
            padding: 8px 16px; border-radius: 20px; font-size: 12px; cursor: pointer;
            display: none; z-index: 999;
        }
        body.preview-mode .exit-preview-btn { display: block; }
    </style>
</head>
<body>

    <!-- é€€å‡ºé¢„è§ˆçš„æµ®çª— -->
    <div class="exit-preview-btn" onclick="togglePreview(false)">æŒ‰ ESC é€€å‡ºé¢„è§ˆ</div>

    <div class="app-container">
        <!-- å·¦ä¾§ -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div><h2>åˆ›å»ºä½œå“é›†</h2><div class="status-text" id="status">è‡ªåŠ¨ä¿å­˜</div></div>
            </div>

            <div class="tab-group">
                <div class="tab-btn active" onclick="switchTab('content', this)">æ­£æ–‡</div>
                <div class="tab-btn" onclick="switchTab('settings', this)">è®¾ç½®</div>
            </div>

            <!-- å†…å®¹é¢æ¿ -->
            <div id="panel-content" class="panel active">
                <!-- æ‹–æ‹½ä¸Šä¼ åŒº -->
                <div class="upload-area" id="dropArea" onclick="document.getElementById('fileInput').click()">
                    <div class="upload-icon">+ ä¸Šä¼ å›¾ç‰‡/è§†é¢‘</div>
                    <div class="upload-desc">PNG/JPG/GIF/MOV/MP4 â‰¤100M</div>
                    <input type="file" id="fileInput" multiple accept="image/*,video/*">
                </div>
                <!-- å·²ä¸Šä¼ åˆ—è¡¨ -->
                <div class="layer-list" id="layerList"></div>
            </div>

            <!-- è®¾ç½®é¢æ¿ -->
            <div id="panel-settings" class="panel">
                <div class="form-group">
                    <div class="label-row"><span class="label-text">å¤§èƒŒæ™¯è‰²</span></div>
                    <div class="input-wrapper">
                        <div class="color-preview-box" id="color-preview" style="background-color: #FFFFFF;">
                            <input type="color" oninput="updateBg(this.value)">
                        </div>
                        <span style="margin-left:10px; font-size:12px; color:#666;">ç‚¹å‡»è‰²å—ä¿®æ”¹</span>
                    </div>
                </div>
                <div class="form-group">
                    <div class="label-row"><span class="label-text">å›¾ç‰‡ä¸Šä¸‹é—´è·</span></div>
                    <div class="input-wrapper">
                        <input type="number" class="custom-input" value="0" oninput="updateSpacing(this.value)">
                        <span style="font-size:12px;">px</span>
                    </div>
                </div>
            </div>
        </aside>

        <!-- å³ä¾§ -->
        <main class="main-content">
            <div class="top-bar">
                <button class="btn btn-outline" onclick="togglePreview(true)">â›¶ é¢„è§ˆ</button>
                <button class="btn btn-outline" onclick="alert('å·²ä¿å­˜åˆ°æœ¬åœ°ç¼“å­˜')">ğŸ’¾ ä¿å­˜</button>
                <button class="btn btn-primary" onclick="alert('è¯·å°†ç”Ÿæˆçš„ index.html ä¸Šä¼ åˆ° GitHub')">â¤ å‘å¸ƒ</button>
            </div>
            <div class="canvas-area" id="canvasArea">
                <div class="artwork-preview" id="previewCanvas">
                    <!-- è¿™é‡Œä¼šåŠ¨æ€æ’å…¥å›¾ç‰‡å’Œè§†é¢‘ -->
                    <div style="padding:50px; text-align:center; color:#ccc;" id="empty-tip">
                        è¯·ä»å·¦ä¾§æ‹–å…¥å›¾ç‰‡æˆ–è§†é¢‘
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        const dropArea = document.getElementById('dropArea');
        const fileInput = document.getElementById('fileInput');
        const previewCanvas = document.getElementById('previewCanvas');
        const layerList = document.getElementById('layerList');
        const emptyTip = document.getElementById('empty-tip');

        // 1. æ‹–æ‹½ä¸Šä¼ é€»è¾‘
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, preventDefaults, false);
        });
        function preventDefaults(e) { e.preventDefault(); e.stopPropagation(); }

        dropArea.addEventListener('dragover', () => dropArea.classList.add('drag-over'));
        dropArea.addEventListener('dragleave', () => dropArea.classList.remove('drag-over'));
        dropArea.addEventListener('drop', handleDrop);
        fileInput.addEventListener('change', function() { handleFiles(this.files) });

        function handleDrop(e) {
            dropArea.classList.remove('drag-over');
            const files = e.dataTransfer.files;
            handleFiles(files);
        }

        // 2. å¤„ç†æ–‡ä»¶ (æ ¸å¿ƒï¼šæ”¯æŒè§†é¢‘)
        function handleFiles(files) {
            if (files.length > 0) emptyTip.style.display = 'none';
            
            ([...files]).forEach(file => {
                const url = URL.createObjectURL(file);
                const isVideo = file.type.startsWith('video') || file.name.endsWith('.mov');
                
                // A. æ·»åŠ åˆ°ä¾§è¾¹æ åˆ—è¡¨
                const listItem = document.createElement('div');
                listItem.className = 'layer-item';
                listItem.innerHTML = `
                    <div class="layer-thumb" style="background:${isVideo ? '#000' : `url(${url}) center/cover`}"></div>
                    <div class="layer-name">${file.name}</div>
                `;
                layerList.appendChild(listItem);

                // B. æ·»åŠ åˆ°å³ä¾§ç”»å¸ƒ
                let element;
                if (isVideo) {
                    // è§†é¢‘è®¾ç½®ï¼šè‡ªåŠ¨æ’­æ”¾ã€å¾ªç¯ã€é™éŸ³ (è¿™æ˜¯ç½‘é¡µè§†é¢‘èƒŒæ™¯çš„æ ‡å‡†å†™æ³•)
                    element = document.createElement('video');
                    element.src = url;
                    element.autoplay = true;
                    element.loop = true;
                    element.muted = true;
                    element.setAttribute('playsinline', ''); // å…¼å®¹æ‰‹æœº
                } else {
                    element = document.createElement('img');
                    element.src = url;
                }
                
                // é»˜è®¤æ ·å¼
                element.style.marginBottom = '0px'; 
                previewCanvas.appendChild(element);
            });
            
            document.getElementById('status').innerText = 'å·²è‡ªåŠ¨ä¿å­˜';
        }

        // 3. é¢„è§ˆæ¨¡å¼é€»è¾‘ (éšè—UI)
        function togglePreview(show) {
            if (show) {
                document.body.classList.add('preview-mode');
            } else {
                document.body.classList.remove('preview-mode');
            }
        }
        // æŒ‰ ESC é€€å‡ºé¢„è§ˆ
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') togglePreview(false);
        });

        // 4. è®¾ç½®é€»è¾‘
        function switchTab(name, btn) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
            btn.classList.add('active');
            document.getElementById('panel-' + name).classList.add('active');
        }

        function updateBg(color) {
            document.getElementById('color-preview').style.backgroundColor = color;
            previewCanvas.style.backgroundColor = color;
        }

        function updateSpacing(val) {
            const items = previewCanvas.querySelectorAll('img, video');
            items.forEach(el => el.style.marginBottom = val + 'px');
        }
    </script>
</body>
</html>
